version: 0.2

phases:
    install:
        commands:
            - mkdir -p ~/.ssh
            - echo "$build_ssh_key" > ~/.ssh/id_rsa
            - chmod 600 ~/.ssh/id_rsa
            - ssh-keygen -F github.com || ssh-keyscan github.com >>~/.ssh/known_hosts
            - git config --global url."git@github.com:".insteadOf "https://github.com/"
            - git init
            - git remote add origin git@github.com:jessiepuls/jessie.wtf.git
            - git fetch
            - git checkout -t origin/master
            - git submodule init
            - git submodule update --recursive
    build:
        commands:
            - echo "Building site"
            - cd site
            - hugo
            - echo "S3 Upload Beginning"
            - aws s3 sync public/ s3://www.jessie.wtf/ --region us-east-1 --delete --acl public-read
            - echo "S3 Upload Complete"

    post_build:
        commands:
            - echo "Build complete"
#            - aws sns publish --topic-arn YOUR_TOPIC_ARN --subject 'AWS CodeBuild Complete' --message 'Your build using AWS CodeBuild has been completed. Check the CodeBuild console to see the details.'